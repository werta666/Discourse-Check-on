# Discourse Check-on æ’ä»¶

ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„Discourseç¤ºä¾‹æ’ä»¶ï¼Œå±•ç¤ºäº†æ’ä»¶å¼€å‘çš„æœ€ä½³å®è·µå’Œå„ç§åŠŸèƒ½å®ç°ã€‚

## ä½œè€…ä¿¡æ¯

- **ä½œè€…**: Pandacc
- **GitHub**: https://github.com/werta666/Discourse-Check-on
- **ç‰ˆæœ¬**: 1.1.0 (å·²ä¿®å¤APIå¼ƒç”¨è­¦å‘Š)

## ğŸš€ å¿«é€Ÿè®¿é—®

- **æ’ä»¶ç®¡ç†é¡µé¢**: `/discourse-check-on`
- **ç»Ÿè®¡API**: `/discourse-check-on/stats`
- **çŠ¶æ€åˆ‡æ¢API**: `/discourse-check-on/toggle` (éœ€ç®¡ç†å‘˜æƒé™)

## âœ… æœ€æ–°æ›´æ–° (v1.1.0)

- ğŸ”§ **APIç°ä»£åŒ–**: ä¿®å¤æ‰€æœ‰Discourse APIå¼ƒç”¨è­¦å‘Š
- ğŸ¯ **å…¼å®¹æ€§**: æ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„Discourse
- ğŸ§¹ **ä»£ç ä¼˜åŒ–**: æå‡ä»£ç è´¨é‡å’Œæ€§èƒ½
- âœ¨ **æ— è­¦å‘Šè¿è¡Œ**: å®Œå…¨æ¶ˆé™¤æ§åˆ¶å°è­¦å‘Šä¿¡æ¯

## æ’ä»¶åŠŸèƒ½

### ğŸ¯ ä¸»è¦åŠŸèƒ½

1. **æ’ä»¶çŠ¶æ€ç®¡ç†**
   - å¯ç”¨/ç¦ç”¨æ’ä»¶åŠŸèƒ½
   - å®æ—¶çŠ¶æ€æ˜¾ç¤º
   - ç®¡ç†å‘˜æ§åˆ¶é¢æ¿
   - è®¿é—®åœ°å€: `/discourse-check-on`

2. **ç”¨æˆ·æ¬¢è¿ç³»ç»Ÿ**
   - æ–°ç”¨æˆ·è‡ªåŠ¨æ¬¢è¿æ¶ˆæ¯
   - è‡ªå®šä¹‰æ¬¢è¿å†…å®¹
   - æ™ºèƒ½æ˜¾ç¤ºé€»è¾‘ï¼ˆä»…å¯¹7å¤©å†…æ–°ç”¨æˆ·æ˜¾ç¤ºï¼‰
   - å¤šçº§åˆ«åŠŸèƒ½æ”¯æŒï¼ˆåŸºç¡€/é«˜çº§/ä¸“ä¸šç‰ˆï¼‰

3. **ç»Ÿè®¡ä¿¡æ¯å±•ç¤º**
   - æ€»ç”¨æˆ·æ•°ç»Ÿè®¡
   - æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
   - ä¸»é¢˜æ•°é‡ç»Ÿè®¡
   - Check-onä¸»é¢˜ç»Ÿè®¡
   - åŠ¨æ€åŠ è½½ç»Ÿè®¡æ•°æ®

4. **ç°ä»£åŒ–ç•Œé¢**
   - å“åº”å¼è®¾è®¡
   - å¯¼èˆªæ å›¾æ ‡é›†æˆ
   - ä¸»é¢˜çŠ¶æ€æŒ‡ç¤ºå™¨
   - æ— APIå¼ƒç”¨è­¦å‘Š

### âš™ï¸ é…ç½®é€‰é¡¹

æ’ä»¶æä¾›äº†5ä¸ªå¯é…ç½®çš„è®¾ç½®é€‰é¡¹ï¼š

1. **discourse_check_on_enabled** (å¸ƒå°”å€¼)
   - é»˜è®¤å€¼: `true`
   - æè¿°: å¯ç”¨/ç¦ç”¨æ’ä»¶ä¸»è¦åŠŸèƒ½

2. **discourse_check_on_feature_level** (æšä¸¾)
   - é€‰é¡¹: `basic`, `advanced`, `premium`
   - é»˜è®¤å€¼: `basic`
   - æè¿°: é€‰æ‹©æ’ä»¶åŠŸèƒ½çº§åˆ«

3. **discourse_check_on_auto_greeting** (å¸ƒå°”å€¼)
   - é»˜è®¤å€¼: `false`
   - æè¿°: è‡ªåŠ¨ä¸ºæ–°ç”¨æˆ·æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯

4. **discourse_check_on_display_stats** (å¸ƒå°”å€¼)
   - é»˜è®¤å€¼: `true`
   - æè¿°: åœ¨æ’ä»¶ç•Œé¢ä¸­æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯

5. **discourse_check_on_custom_message** (å­—ç¬¦ä¸²)
   - é»˜è®¤å€¼: "æ¬¢è¿ä½¿ç”¨Discourse Check-onæ’ä»¶ï¼"
   - æè¿°: è‡ªå®šä¹‰æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹
   - æ”¯æŒå¤šè¯­è¨€æœ¬åœ°åŒ–

### ğŸŒ å›½é™…åŒ–æ”¯æŒ

æ’ä»¶å®Œå…¨æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ï¼š

- **ä¸­æ–‡ (zh_CN)**: å®Œæ•´çš„ä¸­æ–‡ç•Œé¢å’Œæ¶ˆæ¯
- **English (en)**: å®Œæ•´çš„è‹±æ–‡ç•Œé¢å’Œæ¶ˆæ¯
- è‡ªåŠ¨æ ¹æ®ç”¨æˆ·è¯­è¨€è®¾ç½®æ˜¾ç¤ºå¯¹åº”è¯­è¨€

### ğŸ¨ ç•Œé¢ç‰¹æ€§

1. **å“åº”å¼è®¾è®¡**
   - æ¡Œé¢ç«¯ä¼˜åŒ–å¸ƒå±€
   - ç§»åŠ¨ç«¯å‹å¥½ç•Œé¢
   - è‡ªé€‚åº”ç»„ä»¶è®¾è®¡

2. **ç°ä»£åŒ–UI**
   - ç¾è§‚çš„å¡ç‰‡å¼å¸ƒå±€
   - çŠ¶æ€æŒ‡ç¤ºå™¨
   - äº¤äº’å¼æŒ‰é’®å’ŒåŠ¨ç”»
   - å¯¼èˆªæ å›¾æ ‡é›†æˆ

3. **ä¸»é¢˜çŠ¶æ€æŒ‡ç¤º**
   - æ–°å»ºä¸»é¢˜æ ‡è®°
   - ç²¾é€‰ä¸»é¢˜æ ‡è¯†
   - å½’æ¡£ä¸»é¢˜æ˜¾ç¤º

### ğŸ”§ æŠ€æœ¯æ”¹è¿› (v1.2.0) - æœ€æ–°ä¿®å¤

1. **APIç°ä»£åŒ– - å®Œå…¨å…¼å®¹Discourse 2024**
   - âœ… ä½¿ç”¨ `api.headerIcons.add` é…åˆGlimmerç»„ä»¶æ›¿ä»£å¼ƒç”¨çš„ `api.decorateWidget`
   - âœ… ä½¿ç”¨Plugin Outletsæ›¿ä»£å¼ƒç”¨çš„widgetè£…é¥°å™¨
   - âœ… åˆ›å»ºç°ä»£Glimmerç»„ä»¶ (.gjsæ–‡ä»¶) æ›¿ä»£createWidget
   - âœ… ç§»é™¤æ‰€æœ‰å¼ƒç”¨çš„APIè°ƒç”¨ï¼Œæ¶ˆé™¤æ§åˆ¶å°è­¦å‘Š

2. **ç»„ä»¶ç°ä»£åŒ–**
   - æ–°å¢ `DiscourseCheckOnHeaderIcon.gjs` - ç°ä»£headerå›¾æ ‡ç»„ä»¶
   - æ–°å¢ `DiscourseCheckOnStats.gjs` - ç°ä»£ç»Ÿè®¡ç»„ä»¶
   - ä½¿ç”¨Plugin Outlet `topic-list-header` è¿›è¡Œç»„ä»¶æ¸²æŸ“
   - å®Œå…¨å…¼å®¹Glimmerç»„ä»¶ç³»ç»Ÿ

3. **ä»£ç è´¨é‡**
   - ä¿®å¤æ‰€æœ‰å¼ƒç”¨APIè­¦å‘Š
   - ä½¿ç”¨ç°ä»£JavaScriptè¯­æ³•
   - ä¼˜åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - æå‡æ€§èƒ½å’Œç¨³å®šæ€§

## å®‰è£…æ–¹æ³•

### 1. é€šè¿‡Gitå…‹éš†ï¼ˆæ¨èï¼‰

```bash
cd /var/discourse/containers/app.yml
```

åœ¨ `app.yml` æ–‡ä»¶çš„ `hooks.after_code` éƒ¨åˆ†æ·»åŠ ï¼š

```yaml
hooks:
  after_code:
    - exec:
        cd: $home/plugins
        cmd:
          - git clone https://github.com/werta666/Discourse-Check-on.git
```

### 2. æ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æ’ä»¶æ–‡ä»¶
2. å°†æ’ä»¶æ–‡ä»¶å¤¹æ”¾ç½®åˆ° Discourse çš„ `plugins/` ç›®å½•
3. é‡å¯ Discourse

### 3. é‡å»ºå®¹å™¨

```bash
cd /var/discourse
./launcher rebuild app
```

## ä½¿ç”¨è¯´æ˜

### ç®¡ç†å‘˜æ“ä½œ

1. **è®¿é—®æ’ä»¶è®¾ç½®**
   - è¿›å…¥ç®¡ç†é¢æ¿ â†’ è®¾ç½® â†’ æ’ä»¶
   - æ‰¾åˆ° "Discourse Check-on" ç›¸å…³è®¾ç½®

2. **æ’ä»¶æ§åˆ¶é¢æ¿**
   - ç®¡ç†å‘˜å¯åœ¨å¯¼èˆªæ çœ‹åˆ°æ’ä»¶å›¾æ ‡ (check-circle)
   - ç‚¹å‡»è®¿é—® `/discourse-check-on` é¡µé¢
   - å¯ä»¥å¯ç”¨/ç¦ç”¨æ’ä»¶åŠŸèƒ½
   - å®æ—¶çŠ¶æ€åé¦ˆ

### ç”¨æˆ·ä½“éªŒ

1. **æ–°ç”¨æˆ·æ¬¢è¿**
   - æ–°æ³¨å†Œç”¨æˆ·ï¼ˆ7å¤©å†…ï¼‰ä¼šçœ‹åˆ°æ¬¢è¿å¼¹çª—
   - å¯é€šè¿‡è®¾ç½®å…³é—­æ­¤åŠŸèƒ½

2. **ç»Ÿè®¡ä¿¡æ¯æŸ¥çœ‹**
   - åœ¨ä¸»é¢˜åˆ—è¡¨é¡µé¢å¯çœ‹åˆ°ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡
   - ç‚¹å‡»"åŠ è½½ç»Ÿè®¡ä¿¡æ¯"æŒ‰é’®æŸ¥çœ‹è¯¦ç»†æ•°æ®

## ğŸ”— API ç«¯ç‚¹

æ’ä»¶æä¾›ä»¥ä¸‹APIç«¯ç‚¹ï¼š

### ä¸»è¦ç«¯ç‚¹
- **`GET /discourse-check-on`** - æ’ä»¶ä¸»é¡µé¢ï¼Œæ˜¾ç¤ºæ§åˆ¶é¢æ¿
- **`POST /discourse-check-on/toggle`** - åˆ‡æ¢æ’ä»¶çŠ¶æ€ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- **`GET /discourse-check-on/stats`** - è·å–ç»Ÿè®¡ä¿¡æ¯JSONæ•°æ®

### è®¿é—®æ–¹å¼
```bash
# è®¿é—®æ’ä»¶ä¸»é¡µ
https://your-discourse-site.com/discourse-check-on

# è·å–ç»Ÿè®¡æ•°æ®
curl -H 'Accept: application/json' https://your-discourse-site.com/discourse-check-on/stats

# åˆ‡æ¢æ’ä»¶çŠ¶æ€ (éœ€è¦ç®¡ç†å‘˜æƒé™)
curl -X POST -H 'Accept: application/json' https://your-discourse-site.com/discourse-check-on/toggle
```

## å¼€å‘å’Œæµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# åç«¯æµ‹è¯•
bundle exec rspec plugins/Discourse-Check-on/spec

# å‰ç«¯æµ‹è¯•
rake qunit:test
```

### å¼€å‘ç¯å¢ƒ

1. ç¡®ä¿ Discourse å¼€å‘ç¯å¢ƒå·²è®¾ç½®
2. å°†æ’ä»¶æ”¾ç½®åœ¨ `plugins/` ç›®å½•
3. é‡å¯å¼€å‘æœåŠ¡å™¨

## æŠ€æœ¯ç‰¹æ€§

### åç«¯åŠŸèƒ½

- **æ¨¡å‹æ‰©å±•**: æ‰©å±• User å’Œ Topic æ¨¡å‹
- **è‡ªå®šä¹‰æ§åˆ¶å™¨**: æä¾› RESTful API
- **äº‹ä»¶ç›‘å¬**: ç›‘å¬ç”¨æˆ·å’Œä¸»é¢˜åˆ›å»ºäº‹ä»¶
- **åºåˆ—åŒ–å™¨æ‰©å±•**: æ·»åŠ è‡ªå®šä¹‰å­—æ®µåˆ°APIå“åº”

### å‰ç«¯åŠŸèƒ½

- **Ember.js ç»„ä»¶**: ç°ä»£åŒ–çš„å‰ç«¯ç»„ä»¶
- **ç°ä»£æ’ä»¶API**: ä½¿ç”¨æœ€æ–°çš„Discourseæ’ä»¶API (æ— å¼ƒç”¨è­¦å‘Š)
- **Widgetç³»ç»Ÿ**: è‡ªå®šä¹‰Widgetç»„ä»¶
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯
- **å¯¼èˆªé›†æˆ**: æ— ç¼é›†æˆåˆ°Discourseå¯¼èˆªæ 
- **åŠ¨æ€åŠ è½½**: å¼‚æ­¥æ•°æ®åŠ è½½å’ŒçŠ¶æ€ç®¡ç†

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬æ’ä»¶éµå¾ª MIT è®¸å¯è¯ã€‚

## å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: /discourse-check-on é¡µé¢æ˜¾ç¤ºç©ºç™½

**å¯èƒ½åŸå› :**
- æ’ä»¶æœªæ­£ç¡®å®‰è£…æˆ–å¯ç”¨
- ç”¨æˆ·æƒé™ä¸è¶³
- JavaScripté”™è¯¯

**è§£å†³æ–¹æ¡ˆ:**
1. ç¡®ä¿åœ¨Discourseç®¡ç†é¢æ¿ä¸­å¯ç”¨äº†æ’ä»¶
2. ç¡®ä¿å½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜æˆ–ç‰ˆä¸»
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢
5. é‡å»ºDiscourseå®¹å™¨: `./launcher rebuild app`

### é—®é¢˜2: æ–°ç”¨æˆ·æ¬¢è¿å¼¹çª—ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› :**
- è‡ªåŠ¨æ¬¢è¿åŠŸèƒ½æœªå¯ç”¨
- ç”¨æˆ·ä¸ç¬¦åˆæ¡ä»¶ï¼ˆæ³¨å†Œè¶…è¿‡7å¤©ï¼‰
- å·²ç»æ˜¾ç¤ºè¿‡ï¼ˆlocalStorageè®°å½•ï¼‰

**è§£å†³æ–¹æ¡ˆ:**
1. åœ¨ç®¡ç†é¢æ¿ä¸­å¯ç”¨ `discourse_check_on_auto_greeting`
2. ç¡®ä¿æµ‹è¯•ç”¨æˆ·æ˜¯7å¤©å†…æ³¨å†Œçš„
3. æ¸…é™¤localStorageè®°å½•:
   ```javascript
   localStorage.removeItem('discourse_check_on_welcome_shown_' + Discourse.User.current().id);
   location.reload();
   ```

### é—®é¢˜3: åŠŸèƒ½çº§åˆ«åˆ‡æ¢æ²¡æœ‰æ•ˆæœ

**å®é™…åŠŸèƒ½å·®å¼‚:**
- **åŸºç¡€ç‰ˆ**: ç®€å•æ¬¢è¿æ¶ˆæ¯
- **é«˜çº§ç‰ˆ**: å¢å¼ºæ¬¢è¿æ¶ˆæ¯ + é¢å¤–æç¤º
- **ä¸“ä¸šç‰ˆ**: å®Œæ•´æ¬¢è¿æ¶ˆæ¯ + ä¸“ä¸šç‰ˆæ ‡è¯†

**æµ‹è¯•æ–¹æ³•:**
1. åœ¨ç®¡ç†é¢æ¿ä¸­æ›´æ”¹ `discourse_check_on_feature_level`
2. æ¸…é™¤æ¬¢è¿æ¶ˆæ¯è®°å½•ï¼ˆè§ä¸Šæ–¹ä»£ç ï¼‰
3. åˆ·æ–°é¡µé¢æŸ¥çœ‹ä¸åŒçš„æ¬¢è¿å†…å®¹

### è°ƒè¯•å·¥å…·

**æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•:**
```javascript
// æ£€æŸ¥æ’ä»¶è®¾ç½®
console.log(Discourse.SiteSettings.discourse_check_on_enabled);
console.log(Discourse.SiteSettings.discourse_check_on_auto_greeting);
console.log(Discourse.SiteSettings.discourse_check_on_feature_level);

// å¼ºåˆ¶æ˜¾ç¤ºæ¬¢è¿å¼¹çª—
localStorage.removeItem('discourse_check_on_welcome_shown_' + Discourse.User.current().id);
location.reload();
```

**APIæµ‹è¯•:**
```bash
# æµ‹è¯•æ’ä»¶ä¸»é¡µ
curl -H 'Accept: application/json' http://your-site.com/discourse-check-on

# æµ‹è¯•ç»Ÿè®¡API
curl -H 'Accept: application/json' http://your-site.com/discourse-check-on/stats

# æµ‹è¯•çŠ¶æ€åˆ‡æ¢ (éœ€è¦ç®¡ç†å‘˜æƒé™)
curl -X POST -H 'Accept: application/json' http://your-site.com/discourse-check-on/toggle
```

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. ç›´æ¥è®¿é—® `/discourse-check-on` æŸ¥çœ‹æ’ä»¶çŠ¶æ€
2. è¿è¡Œ `ruby validate_plugin.rb` è¿›è¡Œæ’ä»¶éªŒè¯
3. åœ¨GitHubä¸Šæäº¤Issue
4. æŸ¥çœ‹Discourse Metaç¤¾åŒº
5. å‚è€ƒå®˜æ–¹æ’ä»¶å¼€å‘æ–‡æ¡£

## ğŸ‰ ç‰ˆæœ¬å†å²

### v1.1.0 (æœ€æ–°)
- âœ… ä¿®å¤æ‰€æœ‰Discourse APIå¼ƒç”¨è­¦å‘Š
- âœ… ç°ä»£åŒ–å‰ç«¯ä»£ç 
- âœ… æå‡å…¼å®¹æ€§å’Œæ€§èƒ½
- âœ… å®Œå–„æ–‡æ¡£å’Œè®¿é—®åœ°å€

### v1.0.0
- ğŸ¯ åŸºç¡€åŠŸèƒ½å®ç°
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ
- ğŸ¨ å“åº”å¼ç•Œé¢è®¾è®¡

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶ï¼Œä¸»è¦ç”¨äºå±•ç¤ºDiscourseæ’ä»¶å¼€å‘çš„å„ç§åŠŸèƒ½å’Œæœ€ä½³å®è·µã€‚v1.1.0ç‰ˆæœ¬å·²å®Œå…¨å…¼å®¹æœ€æ–°ç‰ˆDiscourseï¼Œå¯å®‰å…¨ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚
